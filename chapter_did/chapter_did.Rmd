---
title: "ScPoEconometrics"
subtitle: "Differences-in-Differences"
author: "Florian Oswald, Gustave Kenedi and Pierre Villedieu"
date: "SciencesPo Paris </br> `r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, "../css/scpo.css", "../css/scpo-fonts.css"]
    nature:
      beforeInit: ["../js/ru_xaringan.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
    includes:
      in_header: "../libs/partials/header.html"
---

layout: true

<div class="my-footer"><img src="../img/logo/ScPo-shield.png" style="height: 60px;"/></div> 

---

```{r setup, include=FALSE,warning=FALSE,message=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

library(emo)
library(tidyverse)
library(ggplot2)
library(kableExtra)
library(zoo)
library(scales)
library(grid)
library(pBrackets)
library(formattable)

  # set seed
set.seed(1234)
```

layout: true

<div class="my-footer"><img src="../img/logo/ScPo-shield.png" style="height: 60px;"/></div> 

---

# Evaluation methods

* Randomized control trials (RCTs) are the gold standard of causal identification

--

* In practice, RCTs are not always possible.

--

* Four main causal evaluation methods used in economics:

  - ***instrumental variables (IV)***,
  - ***propensity-score matching***,
  - ***differences-in-differences (DiD)***, and
  - ***regression discontinuity designs (RDD)***.

--

* These methods are used to identify __causal relationships__ between treatments and outcomes.

--

* In this lecture, we will cover a popular and rigorous program evaluation method: __differences-in-differences__.

--

* Next week we will look at regression discontinuity designs.

---

# Difference-in-Differences (DiD)

* Usual starting point: subjects are not randomly allocated to treatment `r emo::ji("warning")`

--

## DiD Requirements:

--

* 2 time periods: before and after treatment

--

* 2 groups:
  - control group: never receives treatment
  - treatment group: initially untreated and then fully treated
  
--

* Under certain assumptions, control group can be used as the counterfactual for treatment group  

---

# An Example: Minimum Wage and Employment

--

* Imagine you are interested in assessing the __causal__ impact of increasing the minimum wage on (un)employment.

--

* Why is this not that straightforward? Why can't you just regress (un)employment rates on the level of the minimum wage?

--

  - The minimum wage level may be __endogenously__ determined: policymakers may want to have a low minimum wage when employment is low and increase it when conditions improve.

--

* Seminal 1994 [paper](https://www.aeaweb.org/articles?id=10.1257/aer.20150355) by prominent labor economists David Card and Alan Krueger entitled "Minimum Wages and Employment: A Case Study of the Fast-Food Industry in New Jersey and Pennsylvania"

--

* Estimates the effect of an increase in the minimum wage on the employment rate in the fast-food industry. Why this industry?

---

# Institutional Details

* In the US, there is a national minimum wage, but states can depart from it.

--

* April 1, 1992: New Jersey minimum wage increases from $4.25 to $5.05 per hour.

--

* Neighboring Pennsylvania did not change its minimum wage level.

--

```{r, echo = F, out.width = "600px"}
knitr::include_graphics("chapter_did_files/figure-html/nj_penn_map.png")
```

---

# Card and Krueger (1994): Methodology

* Surveyed 410 fast-food establishments in New Jersey (NJ) and eastern Pennsylvania

* Timing:
  - Survey before NJ MW increase: Feb/March 1992
  - Survey after NJ MW increase: Nov/Dec 1992
  
* What comparisons do you think they did?

## Card and Krueger's data: `diffindiff` package

* Let's take a closer at their data
```{r, echo = TRUE, eval = TRUE}
  # install package that contains the cleaned data
remotes::install_github("b-rodrigues/diffindiff")
  # load package
library(diffindiff)
  # load data
ck1994 <- njmin
```

---

class: inverse

# Task 1 (10 minutes)

* Take a look at the dataset and list the variables.

* Keep only the following variables: `state`, `region`, `observation`, `empft`, `emppt`, `wage_st`, `pctaff`.

* Tabulate the number of stores by `state` and by survey wage (`observation`). Does it match what's in Table 1 of the paper?

* Create a variable called `empfte` equal to `empft` + 0.5*`emppt` + `nmgrs`. `empft` and `emppt` correspond respectively to the number of full-time and part-time employees. `nmgrs` corresponds to the number of managers. This is how Card and Krueger compute full-time equivalent (FTE) employment variable (p.775 of the paper).

* Create two other variables: (i) percentage of full-time (FT) employees, (ii) percentage of part-time (PT) employees.


* Compute the average number of FTE employment, average percentage of FT employees, average PT employees and average starting wave (`wage_st`) by state and by survey wage. Compare your results with Table 2 of the paper.

---

# Card and Krueger DiD: Tabular Results

.center[__Average Employment Per Store Before and After the Rise in NJ Minimum Wage__]
```{r, echo = FALSE, eval = TRUE}
# create average of FTE employment by state by survey wage
ck1994 <- ck1994 %>%
  mutate(empfte = empft + 0.5*emppt + nmgrs) %>%
  group_by(state,observation) %>%
  summarise(mean_fte = mean(empfte, na.rm = T))
# change to data.frame format
ck1994 <- as.data.frame(ck1994)

# recode ck1994 to look nice
ck_mw <- data.frame(
  Variable = c("FTE employment before","FTE employment after","Change in mean FTE
employment"),
  PA = c(
    ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "February 1992", "mean_fte"],
    ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "November 1992", "mean_fte"],
    ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "November 1992", "mean_fte"] -
      ck1994[ck1994$state == "Pennsylvania" & ck1994$observation == "February 1992", "mean_fte"]),
  NJ = c(
    ck1994[ck1994$state == "New Jersey" & ck1994$observation == "February 1992", "mean_fte"],
    ck1994[ck1994$state == "New Jersey" & ck1994$observation == "November 1992", "mean_fte"],
    ck1994[ck1994$state == "New Jersey" & ck1994$observation == "November 1992", "mean_fte"] -
      ck1994[ck1994$state == "New Jersey" & ck1994$observation == "February 1992", "mean_fte"]))

# present in table form
ck_mw %>%
  mutate(
    PA = round(PA, 2),
    NJ = round(NJ, 2)
  ) %>%
  mutate(
    PA = ifelse(PA<0,
                cell_spec(PA, "html", background = viridis_pal()(2)[2], color = "white", bold = T, align = "c"),
                cell_spec(PA, "html", background = NULL, color = NULL, align = "c")),
    NJ = ifelse(NJ<1,
                cell_spec(NJ, "html", background = viridis_pal()(2)[1], color = "white", bold = T, align = "center"),
                cell_spec(NJ, "html", background = NULL, color = NULL, align = "c"))
  ) %>%
  kable(format = "html", digits = 2, escape = F,
        col.names = c("Variables", "Pennsylvania", "New Jersey")) %>%
  kable_styling("striped", full_width = F)
```

--

## DiD Estimate

Differences-in-differences causal estimate: 0.59 - 2.17 = __2.76__

--

=> Interpretation: the minimum wage increase led to an __increase__ in FTE employment per store of 2.76 on average.

--

Yes the essence of differences-in-differences is _that_ simple! `r emo::ji("grinning")`

--

Let's look at these results graphically.

---

# DiD Graphically

```{r, echo = F, fig.width = 10, fig.height = 5}
ck_mw <- data.frame(
  date = as.Date(c("010292","010292","011192","011192"), format = "%d%m%y"),
  state = c("Pennsylvania","New Jersey","Pennsylvania","New Jersey"),
  fte_emp = c(23.33,20.44,21.17,21.03)
)

gg_did <- ggplot(ck_mw, aes(x = date, y = fte_emp, color = state)) +
  geom_vline(xintercept = as.Date("010492", format = "%d%m%y"), linetype = "longdash") +
  geom_vline(xintercept = as.Date("010292", format = "%d%m%y"), linetype = "solid") +
  geom_vline(xintercept = as.Date("011192", format = "%d%m%y"), linetype = "solid") +
  ylim(17,24) +
  scale_x_date(labels = date_format("%h %y"),
               limits = c(min(ck_mw$date),as.Date("011292", format = "%d%m%y")),
               date_breaks = "1 month",
               minor_breaks = NULL) +
  labs(x = NULL, y = "Average number of FTE employees per store", color = NULL) +
  scale_colour_viridis_d() +
  theme_bw(base_size = 16) + theme(legend.position="none") +
  annotate("label", x = as.Date("1992-05-28"), y = 23.99, label = "New Jersey minimum wage increases", color = "black", size = 4.5) +
  annotate("label", x = as.Date("1992-02-26"), y = 23.99, label = "Survey before", color = "black", size = 4.5) +
  annotate("label", x = as.Date("1992-11-23"), y = 23.99, label = "Survey after", color = "black", size = 4.5)
gg_did
```

---

# DiD Graphically

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_graph <- gg_did +
  geom_point(size = 3) +
  geom_line() +
  annotate("label", x = as.Date("1992-05-15"), y = 23, label = "Pennsylvania", color = viridis_pal()(2)[2], size = 6) +
  annotate("label", x = as.Date("1992-05-01"), y = 21, label = "New Jersey", color = viridis_pal()(2)[1], size = 6)
gg_did_graph
```

---

# DiD Graphically

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did2 <- gg_did_graph +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]-(ck_mw[1,"fte_emp"]-ck_mw[3,"fte_emp"])),
               color = "#FDE725FF", linetype = "dashed") +
  annotate("label", x = as.Date("1992-05-10"), y = 18.9, label = "New Jersey counterfactual", color = viridis_pal()(2)[2], size = 6)
gg_did2
```

---

# DiD Graphically

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did2 +
  annotate("text", x = as.Date("1992-11-26"), y = 19.7, label = "Treatment\nEffect", color = "black", size = 6)
x = 623
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
```

---

# What if we had done a naive comparison?

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_graph +
  annotate("text", x = as.Date("1992-11-26"), y = 20.9, label = "Naive\nTreatment\nEffect", color = "black", size = 6) +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]),
               color = viridis_pal()(2)[1], linetype = "dashed") +
  annotate("label", x = as.Date("1992-06-08"), y = 20.1, label = "Naive New Jersey counterfactual", color = viridis_pal()(2)[1], size = 6)
x = 623
ymin = 150
ymax = ymin+24
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")

```

---

# What if we had done a naive comparison?

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_graph +
  annotate("text", x = as.Date("1992-11-26"), y = 21.1, label = "Naive\nTreatment\nEffect", color = "black", size = 5) +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]),
               color = viridis_pal()(2)[1], linetype = "dashed") +
  annotate("label", x = as.Date("1992-06-15"), y = 20.1, label = "Naive New Jersey counterfactual", color = viridis_pal()(2)[1], size = 5) +
  annotate("text", x = as.Date("1992-11-26"), y = 19.45, label = "Real\nTreatment\nEffect", color = "black", size = 5) +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]-(ck_mw[1,"fte_emp"]-ck_mw[3,"fte_emp"])),
               color = "#FDE725FF", linetype = "dashed") +
  annotate("label", x = as.Date("1992-05-20"), y = 18.9, label = "New Jersey counterfactual", color = viridis_pal()(2)[2], size = 5)
x = 635
ymin = 150
ymax = ymin+24
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
x = 623
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")

```

---

# DiD Crucial Assumption: Parallel Trends

* __Common or parallel trends__: Absent any minimum wage increase, would Pennsylvania's fast-food employment trend have been what we should have expected to see in New Jersey?

--

* This assumption states that Pennsylvania's fast-food employment trend between February and November 1992 provides a reliable counterfactual employment trend New Jersey's fast-food industry *would have experienced* had New Jersey not increased its minimum wage.

--

* Impossible to completely validate or invalidate this assumption.

* *Intuitive check:* compare trends before policy change (and after policy change if no expected medium-term effects)

---

#  Parallel Trends: Graphically

```{r, echo = FALSE, eval = TRUE, fig.width = 10, fig.height = 5}
gg_did2
```

---

# Checking the parallel trends assumption


```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend <- ggplot(ck_mw, aes(x = date, y = fte_emp, color = state)) +
  geom_point(size = 3) +
  geom_line() +
  geom_vline(xintercept = as.Date("010492", format = "%d%m%y"), linetype = "longdash") +
  geom_vline(xintercept = as.Date("010292", format = "%d%m%y"), linetype = "solid") +
  geom_vline(xintercept = as.Date("011192", format = "%d%m%y"), linetype = "solid") +
  ylim(17,24) +
  scale_x_date(labels = date_format("%h %y"),
               limits = c(as.Date("011091", format = "%d%m%y"),as.Date("011292", format = "%d%m%y")),
               date_breaks = "1 month",
               minor_breaks = NULL) +
  labs(x = NULL, y = "Average number of FTE employees per store", color = NULL) +
  scale_colour_viridis_d() +
  theme_bw(base_size = 16) + theme(legend.position="none") +
  annotate("label", x = as.Date("1992-06-25"), y = 23.99, label = "New Jersey minimum wage increases", color = "black", size = 4.5) +
  annotate("label", x = as.Date("1991-12-28"), y = 23.99, label = "Survey before", color = "black", size = 4.5) +
  annotate("label", x = as.Date("1992-11-23"), y = 23.99, label = "Survey after", color = "black", size = 4.5)

gg_did_trend +
  annotate("label", x = as.Date("1991-11-17"), y = 21.5, label = "What happened here?", color = "black", size = 6)
```

---

# Checking the parallel trends assumption

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend +
  # PA
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = 24, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[1,"fte_emp"]), color = "#FDE725FF", linetype = "dashed") +
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = 22, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[1,"fte_emp"]), color = "#FDE725FF", linetype = "dashed") +
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = 20, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[1,"fte_emp"]), color = "#FDE725FF", linetype = "dashed") +
  # NJ
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = 20, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]), color = "#440154FF", linetype = "dashed") +
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = 19, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]), color = "#440154FF", linetype = "dashed") +
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = 18, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]), color = "#440154FF", linetype = "dashed")
```

---

# Parallel trends assumption => Verified `r emo::ji("white_check_mark")`

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_val <- gg_did_trend +
  # PA
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = ck_mw[1,"fte_emp"] + 0.3, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[1,"fte_emp"]), color = "#FDE725FF", linetype = "dashed") +
  # NJ
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = ck_mw[2,"fte_emp"] + 0.3, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]), color = "#440154FF", linetype = "dashed")
gg_did_trend_val
```

---

# Parallel trends assumption => Verified `r emo::ji("white_check_mark")`

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_val +
  annotate("rect", xmin=as.Date("011091", format = "%d%m%y"), xmax=as.Date("010292", format = "%d%m%y"), ymin=20 , ymax=24, alpha=0.4, color="#21908CFF", fill="#21908CFF") +
  annotate("text", x=as.Date("011291", format = "%d%m%y"), y=22, label = "Employment trends\nare similar", color = "black", size = 5)
```

---

# Parallel trends assumption => Not verified `r emo::ji("x")`

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_notval <- gg_did_trend +
  # PA
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = ck_mw[1,"fte_emp"] + 0.5, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[1,"fte_emp"]), color = "#FDE725FF", linetype = "dashed") +
  # NJ
  geom_segment(aes(x = as.Date("011091", format = "%d%m%y"), y = ck_mw[2,"fte_emp"] - 0.6, xend = as.Date("010292", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]), color = "#440154FF", linetype = "dashed")
gg_did_trend_notval
```

---

# Parallel trends assumption => Not verified `r emo::ji("x")`

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_notval + 
  annotate("rect", xmin=as.Date("011091", format = "%d%m%y"), xmax=as.Date("010292", format = "%d%m%y"), ymin=19.5 , ymax=24, alpha=0.4, color="#21908CFF", fill="#21908CFF") +
  annotate("text", x=as.Date("011291", format = "%d%m%y"), y=22, label = "Employment trends\nare not similar", color = "black", size = 5)
```

---

# Parallel trends assumption => Not verified `r emo::ji("x")`

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_notval + 
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"] + 1.35), color = "#440154FF", linetype = "dashed")
```

---

# Parallel trends assumption => Not verified `r emo::ji("x")`

```{r, echo = F, fig.width = 10, fig.height = 5}
gg_did_trend_notval + 
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"] + 1.35), color = "#440154FF", linetype = "dashed") +
  geom_segment(aes(x = as.Date("010292", format = "%d%m%y"), y = ck_mw[2,"fte_emp"], xend = as.Date("011192", format = "%d%m%y"), yend = ck_mw[2,"fte_emp"]-(ck_mw[1,"fte_emp"]-ck_mw[3,"fte_emp"])),
               color = "#FDE725FF", linetype = "dashed") +
  annotate("label", x = as.Date("1992-05-20"), y = 18.9, label = "New Jersey counterfactual", color = viridis_pal()(2)[2], size = 5) +
  annotate("text", x = as.Date("1992-11-28"), y = 19.45, label = "DiD\nTreatment\nEffect", color = "black", size = 5) +
  annotate("text", x = as.Date("1992-11-28"), y = 21.6, label = "Real\nTreatment\nEffect", color = "black", size = 5)
x = 640
ymin = 117
ymax = ymin+32
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
x = 640
ymin = 150
ymax = ymin+114
grid.brackets(x,
              ymin,
              x,
              ymax,
              h = 0.05, lwd=1, col="black")
```

---

# DiD in Regression Form

* In practice, DiD is usually estimated on more than 2 periods (4 observations)

* There are more data points before and after the policy change

--

3 ingredients:

1. __Treatment dummy variable__: $TREAT_s$ where the $s$ subscript reminds us that the treatment is at the state level

1. __Post-treatment periods dummy variables__: $POST_t$ where the $t$ subscript reminds us that this variable varies over time

1. __Interaction term between the two__: $TREAT_s \times POST_t$ => the ***coefficient on this term is the DiD causal effect***!

---

# DiD in Regression Form

__Treatment dummy variable__
$$
TREAT_s = \begin{cases}\begin{array}{lcl}
0 \quad \text{if } s = \text{Pennsylvania} \\\
1 \quad \text{if } s = \text{New Jersey}
\end{array}\end{cases}
$$

--

__Post-treatment periods dummy variables__
$$
POST_t = \begin{cases}\begin{array}{lcl}
0 \quad \text{if } t < \text{April 1, 1992} \\\
1 \quad \text{if } t \geq \text{April 1, 1992}
\end{array}\end{cases}
$$

--

__Which observations correspond to $TREAT_s \times POST_t$?__

--

* Let's put all these ingredients together:
$$EMP_{st} = \alpha + \beta TREAT_s + \gamma POST_t + \delta_{DiD} (TREAT_s \times POST_t) + \varepsilon_{st}$$

* $\delta_{DiD}$: causal effect of the minimum wage increase on employment

---

# Understanding the Regression

$$EMP_{st} = \alpha + \beta TREAT_s + \gamma POST_t + \delta_{DiD} (TREAT_s \times POST_t) + \varepsilon_{st}$$

--

We have the following:

--

$\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 0) = \alpha$

--

$\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 1) = \alpha + \gamma$

--

$\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 0) = \alpha + \beta$

--

$\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 1) = \alpha + \beta + \gamma + \delta$

--

$$[\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 1)-\mathbb{E}(EMP_{st} \; | \; TREAT_s = 1, POST_t = 0)] - \\
[\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 1)-\mathbb{E}(EMP_{st} \; | \; TREAT_s = 0, POST_t = 0)] = \delta$$


---

class: inverse

# Task 2 (10 minutes)

* Create a dummy variable, `treat`, equal to 0 if `state` is Pennsylvania and 1 if New Jersey.

* Create a dummy variable, `post`, equal to 0 if `observation` is February 1992 and 1 otherwise.

* Estimate the following regression model using the `lm` function:

$$empfte_{st} = \alpha + \beta treat_s + \gamma post_t + \delta_{DiD} (treat_s \times post_t) + \varepsilon_{st}$$

* Do you obtain the same results as before?

---

# Multi-period DiD: Relaxing Common Trends Assumption => Too much?

* When we have data on many years and many states we can relax the common trends assumption

$$EMP_{st} = \alpha + \delta_{DiD} MW_st + \sum_{k=Alaska}^{Wyoming} \beta_k STATE_{kt} + \sum_{j=1985}^{1999} \gamma_j YEAR_{jt} + \varepsilon_{st}$$

---

# Clustered Standard Errors => Too much?



---
class: title-slide-final, middle
background-image: url(../img/logo/ScPo-econ.png)
background-size: 250px
background-position: 9% 19%

# END




|                                                                                                            |                                   |
| :--------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| <a href="mailto:florian.oswald@sciencespo.fr">.ScPored[<i class="fa fa-paper-plane fa-fw"></i>]               | florian.oswald@sciencespo.fr       |
| <a href="https://github.com/ScPoEcon/ScPoEconometrics-Slides">.ScPored[<i class="fa fa-link fa-fw"></i>] | Slides |
| <a href="https://scpoecon.github.io/ScPoEconometrics">.ScPored[<i class="fa fa-link fa-fw"></i>] | Book |
| <a href="http://twitter.com/ScPoEcon">.ScPored[<i class="fa fa-twitter fa-fw"></i>]                          | @ScPoEcon                         |
| <a href="http://github.com/ScPoEcon">.ScPored[<i class="fa fa-github fa-fw"></i>]                          | @ScPoEcon                       |

